<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Configuring Docker Inside a Service Fabric VM &#8211; Justin Wendlandt's Blog</title> <meta name="description" content="If there are ever any settings that need to be changed inside the Docker service that is running inside a Virtual Machine under Service Fabric the only way to accomplish this is through an Azure Resource Manager Virtual Machine Extension.­ &quot;virtualMachineProfile&quot;: { &quot;extensionProfile&quot;: { &quot;extensions&quot;: [ { &quot;properties&quot;: { &quot;publisher&quot;: &quot;Microsoft.Compute&quot;, &quot;type&quot;: &quot;CustomScriptExtension&quot;, &quot;typeHandlerVersion&quot;: &quot;1.7&quot;, &quot;autoUpgradeMinorVersion&quot;: false, &quot;settings&quot;: { &quot;fileUris&quot;: [ &quot;https://iotdata.blob.core.windows.net/deployment/configdocker.ps1&quot; ], &quot;commandToExecute&quot;: &quot;powershell -ExecutionPolicy Unrestricted -File dockerpull.ps1&quot; }, &quot;forceUpdateTag&quot;: &quot;[parameters(&#39;vmExtensionVersion&#39;)]&quot; }, &quot;name&quot;: &quot;CustomScriptExtensionDockerPull&quot; } ] },We can put the following code into the configdocker.ps1 file.New-Item -Path &quot;F:\Docker&quot; -Type DirectorySet-Content &quot;C:\ProgramData\docker\config\daemon.json&quot; &#39;{&quot;graph&quot;: &quot;F:\\Docker&quot;}&#39;Stop-Process -ProcessName dockerd -ForceStart-Sleep -s 1Remove-Item -Path &quot;C:\ProgramData\docker\docker.pid&quot;Start-Sleep -s 1Start-Service -DisplayName &quot;Docker&quot;Start-Sleep -s 1Essentially, we are going to tell it to use the F:\ data disk drive for docker images rather than the C:\ drive (this might be for performance or other reasons).The first line creates a new docker folder.The Set-Content line creates a new file with the json configuration in it per the Docker website.We then stop the process, sleep, remove the .pid and then start the process after that. The sleep statements were unfortunately needed because of the timing that it might take for the Docker service to actually stop."> <meta name="keywords" content="windows, containers, docker, service fabric"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="Configuring Docker Inside a Service Fabric VM"> <meta name="twitter:description" content="If there are ever any settings that need to be changed inside the Docker service that is running inside a Virtual Machine under Service Fabric the only way to accomplish this is through an Azure Resource Manager Virtual Machine Extension.­ &quot;virtualMachineProfile&quot;: { &quot;extensionProfile&quot;: { &quot;extensions&quot;: [ { &quot;properties&quot;: { &quot;publisher&quot;: &quot;Microsoft.Compute&quot;, &quot;type&quot;: &quot;CustomScriptExtension&quot;, &quot;typeHandlerVersion&quot;: &quot;1.7&quot;, &quot;autoUpgradeMinorVersion&quot;: false, &quot;settings&quot;: { &quot;fileUris&quot;: [ &quot;https://iotdata.blob.core.windows.net/deployment/configdocker.ps1&quot; ], &quot;commandToExecute&quot;: &quot;powershell -ExecutionPolicy Unrestricted -File dockerpull.ps1&quot; }, &quot;forceUpdateTag&quot;: &quot;[parameters(&#39;vmExtensionVersion&#39;)]&quot; }, &quot;name&quot;: &quot;CustomScriptExtensionDockerPull&quot; } ] },We can put the following code into the configdocker.ps1 file.New-Item -Path &quot;F:\Docker&quot; -Type DirectorySet-Content &quot;C:\ProgramData\docker\config\daemon.json&quot; &#39;{&quot;graph&quot;: &quot;F:\\Docker&quot;}&#39;Stop-Process -ProcessName dockerd -ForceStart-Sleep -s 1Remove-Item -Path &quot;C:\ProgramData\docker\docker.pid&quot;Start-Sleep -s 1Start-Service -DisplayName &quot;Docker&quot;Start-Sleep -s 1Essentially, we are going to tell it to use the F:\ data disk drive for docker images rather than the C:\ drive (this might be for performance or other reasons).The first line creates a new docker folder.The Set-Content line creates a new file with the json configuration in it per the Docker website.We then stop the process, sleep, remove the .pid and then start the process after that. The sleep statements were unfortunately needed because of the timing that it might take for the Docker service to actually stop."> <meta name="twitter:site" content="@jwendl"> <meta name="twitter:creator" content="@jwendl"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Configuring Docker Inside a Service Fabric VM"> <meta property="og:description" content="If there are ever any settings that need to be changed inside the Docker service that is running inside a Virtual Machine under Service Fabric the only way to accomplish this is through an Azure Resource Manager Virtual Machine Extension.­ &quot;virtualMachineProfile&quot;: { &quot;extensionProfile&quot;: { &quot;extensions&quot;: [ { &quot;properties&quot;: { &quot;publisher&quot;: &quot;Microsoft.Compute&quot;, &quot;type&quot;: &quot;CustomScriptExtension&quot;, &quot;typeHandlerVersion&quot;: &quot;1.7&quot;, &quot;autoUpgradeMinorVersion&quot;: false, &quot;settings&quot;: { &quot;fileUris&quot;: [ &quot;https://iotdata.blob.core.windows.net/deployment/configdocker.ps1&quot; ], &quot;commandToExecute&quot;: &quot;powershell -ExecutionPolicy Unrestricted -File dockerpull.ps1&quot; }, &quot;forceUpdateTag&quot;: &quot;[parameters(&#39;vmExtensionVersion&#39;)]&quot; }, &quot;name&quot;: &quot;CustomScriptExtensionDockerPull&quot; } ] },We can put the following code into the configdocker.ps1 file.New-Item -Path &quot;F:\Docker&quot; -Type DirectorySet-Content &quot;C:\ProgramData\docker\config\daemon.json&quot; &#39;{&quot;graph&quot;: &quot;F:\\Docker&quot;}&#39;Stop-Process -ProcessName dockerd -ForceStart-Sleep -s 1Remove-Item -Path &quot;C:\ProgramData\docker\docker.pid&quot;Start-Sleep -s 1Start-Service -DisplayName &quot;Docker&quot;Start-Sleep -s 1Essentially, we are going to tell it to use the F:\ data disk drive for docker images rather than the C:\ drive (this might be for performance or other reasons).The first line creates a new docker folder.The Set-Content line creates a new file with the json configuration in it per the Docker website.We then stop the process, sleep, remove the .pid and then start the process after that. The sleep statements were unfortunately needed because of the timing that it might take for the Docker service to actually stop."> <meta property="og:url" content="http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/"> <meta property="og:site_name" content="Justin Wendlandt's Blog"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="Justin Wendlandt's Blog" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.png) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Configuring Docker Inside a Service Fabric VM </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#windows">windows</a></li> <li><a href="http://localhost:4000/tags#containers">containers</a></li> <li><a href="http://localhost:4000/tags#docker">docker</a></li> <li><a href="http://localhost:4000/tags#service fabric">service fabric</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <div class="share-buttons"> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> </div> <a href="http://localhost:4000/posts.html" title="posts" class="posts-menu-icon"></a> <a title="http://localhost:4000/projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">19 Aug 2017</div> <p>If there are ever any settings that need to be changed inside the Docker service that is running inside a Virtual Machine under Service Fabric the only way to accomplish this is through an Azure Resource Manager Virtual Machine Extension. ­</p> <figure class="highlight"><pre><code class="language-json" data-lang="json"><span class="w">        </span><span class="s2">"virtualMachineProfile"</span><span class="err">:</span><span class="w"> </span><span class="p">{</span><span class="w">
          </span><span class="nt">"extensionProfile"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
            </span><span class="nt">"extensions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
              </span><span class="p">{</span><span class="w">
                </span><span class="nt">"properties"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                  </span><span class="nt">"publisher"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Microsoft.Compute"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CustomScriptExtension"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"typeHandlerVersion"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.7"</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"autoUpgradeMinorVersion"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
                  </span><span class="nt">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
                    </span><span class="nt">"fileUris"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"https://iotdata.blob.core.windows.net/deployment/configdocker.ps1"</span><span class="w"> </span><span class="p">],</span><span class="w">
                    </span><span class="nt">"commandToExecute"</span><span class="p">:</span><span class="w"> </span><span class="s2">"powershell -ExecutionPolicy Unrestricted -File dockerpull.ps1"</span><span class="w">
                  </span><span class="p">},</span><span class="w">
                  </span><span class="nt">"forceUpdateTag"</span><span class="p">:</span><span class="w"> </span><span class="s2">"[parameters('vmExtensionVersion')]"</span><span class="w">
                </span><span class="p">},</span><span class="w">
                </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CustomScriptExtensionDockerPull"</span><span class="w">
              </span><span class="p">}</span><span class="w">
            </span><span class="p">]</span><span class="w">
          </span><span class="p">},</span></code></pre></figure> <p>We can put the following code into the configdocker.ps1 file.</p> <figure class="highlight"><pre><code class="language-powershell" data-lang="powershell"><span class="nb">New-Item</span> -Path <span class="s2">"F:</span><span class="se">\D</span><span class="s2">ocker"</span> -Type Directory
<span class="nb">Set-Content</span> <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogramData</span><span class="se">\d</span><span class="s2">ocker</span><span class="se">\c</span><span class="s2">onfig</span><span class="se">\d</span><span class="s2">aemon.json"</span> <span class="s1">'{"graph": "F:\\Docker"}'</span>
<span class="nb">Stop-Process</span> -ProcessName dockerd -Force
<span class="nb">Start-Sleep</span> -s 1
<span class="nb">Remove-Item</span> -Path <span class="s2">"C:</span><span class="se">\P</span><span class="s2">rogramData</span><span class="se">\d</span><span class="s2">ocker</span><span class="se">\d</span><span class="s2">ocker.pid"</span>
<span class="nb">Start-Sleep</span> -s 1
<span class="nb">Start-Service</span> -DisplayName <span class="s2">"Docker"</span>
<span class="nb">Start-Sleep</span> -s 1</code></pre></figure> <p>Essentially, we are going to tell it to use the F:\ data disk drive for docker images rather than the C:\ drive (this might be for performance or other reasons).</p> <p>The first line creates a new docker folder.</p> <p>The Set-Content line creates a new file with the json configuration in it per the <a href="https://docs.docker.com/engine/admin/systemd/#runtime-directory-and-storage-driver">Docker website</a>.</p> <p>We then stop the process, sleep, remove the .pid and then start the process after that. The sleep statements were unfortunately needed because of the timing that it might take for the Docker service to actually stop.</p> <br /> <a href="https://twitter.com/intent/tweet?text=http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/" class="btn btn_twitter" title="Share on Twitter"><i class="fa fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a> <a href="https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/" class="btn btn_facebook" title="Share on Facebook"><i class="fa fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a> <a href="https://plus.google.com/share?url=http://localhost:4000/2017/08/19/configure-docker-from-service-fabric-vm/" class="btn btn_google-plus" title="Share on Google Plus"><i class="fa fa-fw fa-google-plus" aria-hidden="true"></i><span> Google+</span></a> <div id="page_uri" value="/2017/08/19/configure-docker-from-service-fabric-vm/" style="display: none;">&nbsp;</div> <div id="page_title" value="Configuring Docker Inside a Service Fabric VM" style="display: none;">&nbsp;</div> <div id="disqus_thread"></div> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> <script type="text/javascript" src="/assets/js/disqus.js"></script> <nav class="pagination"> <a href="http://localhost:4000/2017/08/18/docker-image-net-node-core/" class="pagination_pager" title="Docker Windows Image for IoT Edge ">previous</a> <a href="http://localhost:4000/2017/08/20/create-format-map-drive-on-managed-disks/" class="pagination_pager" title="Create and Format a Disk in a Windows Container ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://taylantatli.me/Halve/images/halve-home-image.png) center center no-repeat;"> <a href="http://taylantatli.me/Halve" class="inactive" target="_blank" rel="nofollow external"> <span> Halve Jekyll Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://cloud.githubusercontent.com/assets/754514/14509720/61c61058-01d6-11e6-93ab-0918515ecd56.png) center center no-repeat;"> <a href="http://taylantatli.me/Moon" target="_blank" rel="nofollow external"> <span> Moon Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Ramme/master/assets/img/screenshot-post.png) center center no-repeat;"> <a href="http://taylantatli.me/Ramme" target="_blank" rel="nofollow external"> <span> Ramme Jekyll Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Daisy-Pelican-Theme/master/Preview-1.png) center center no-repeat;"> <a href="http://taylantatli.me/Daisy-Pelican-Theme/" target="_blank" rel="nofollow external"> <span> Daisy Pelican Theme </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/Block-Icon-Theme/master/Preview.png) center center no-repeat;"> <a href="https://github.com/TaylanTatli/Block-Icon-Theme" class="inactive" target="_blank" rel="nofollow external"> <span> Block Icon Theme <br><em>in progress</em> </span> </a> </li> <li style="background:url(https://raw.githubusercontent.com/TaylanTatli/StartPage/master/preview.png) center center no-repeat;"> <a href="http://taylantatli.me/StartPage/" class="inactive" target="_blank" rel="nofollow external"> <span> Start Page <br><em>in progress</em> </span> </a> </li> </ul> </div> </body> </html>
